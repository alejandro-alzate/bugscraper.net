// Thanks to https://phrase.com/blog/posts/step-step-guide-javascript-localization/

const translations = {
    "en": {
        "language-name": "English",

        "button-steam-wishlist": "ğŸ› Wishlist on Steam", // "wishlist" is a verb here, not a noun, as in "please wishlist on Steam"
        "button-steam": "ğŸ› Steam", 
        "button-itchio": "ğŸª itch.io",
        "button-discord": "ğŸ® Discord", 
        "button-twitter": "ğŸ¦ Twitter", 
        "button-bluesky": "ğŸ¦‹ Bluesky", 
        "button-instagram": "ğŸ“· Instagram",  
        "button-github": "ğŸ˜º GitHub", 
        "button-press": "ğŸ—ï¸ Articles",
        "button-press-kit": "ğŸ“° Download the press kit",
        "button-email": "âœ‰ï¸ Email",
        "desc-1": "Welcome to the Bugscraper.",
        "desc-2": "<b>Bugscraper</b> is a <b>solo</b> or <b>co-op roguelike shooter</b>. As you climb toward your tyrannical boss's office, you'll battle floor after floor of enemies. Using a wide arsenal of weapons and upgrades, mow them down and aim for the top!",
        "desc-long-1": "ğŸœ Play as <b>Mio and his friends</b>, in <b>solo</b> or in <b>local co-op</b> with up to 4 players.",
        "desc-long-2": "ğŸ› Fight through a <b>hundred waves</b> packed with <b>furious enemies</b> and <b>tough bosses</b>.",
        "desc-long-3": "ğŸ Gather <b>new weapons</b>, drink up on <b>helpful upgrades</b>, and get ready for battle on the next floor!",
        "desc-long-4": "ğŸ <b>Reach the top</b> of the building and settle the score with your boss!",
        "screenshot-title": "Screenshots",
        
        "contact": "Contact:",
        "footer-source": "Source code for this website",
        "banner-author": "Banner art by:",

        "html-title-press": "Bugscraper Â· Press",
        "press-title": "Press",
        "press-article-list-title": "What people are saying about the game",
        "press-article-list-add-yours": "Want to add yours?",
        "press-article-list-add-yours-email": "Email me!",
    },
    "fr": {
        "language-name": "FranÃ§ais",

        "button-steam-wishlist": "ğŸ› Wishlistez sur Steam",
        "button-steam": "ğŸ› Steam",
        "button-itchio": "ğŸª itch.io",
        "button-discord": "ğŸ® Discord", 
        "button-twitter": "ğŸ¦ Twitter", 
        "button-bluesky": "ğŸ¦‹ Bluesky", 
        "button-instagram": "ğŸ“· Instagram",
        "button-github": "ğŸ˜º GitHub", 
        "button-press": "ğŸ—ï¸ Articles",
        "button-press-kit": "ğŸ“° TÃ©lÃ©chargez le kit de presse",
        "button-email": "âœ‰ï¸ Email", 
        "desc-1": "Bienvenue dans le Bugscraper.",
        "desc-2": "<b>Bugscraper</b> est un <b>roguelike shooter solo ou coopÃ©ratif</b>. En voie vers le bureau de votre patron tyrannique, vous ferez face Ã  des vagues d'ennemis Ã  chaque Ã©tage. Ã€ l'aide d'une multitude d'armes et une grande diversitÃ© d'amÃ©liorations, Ã©liminez les et visez le sommet !",
        "desc-long-1": "ğŸœ Vous incarnerez <b>Mio et ses amis</b>, en <b>solo</b> ou en <b>multijoueur local coopÃ©ratif</b> avec jusqu'Ã  4 joueurs.",
        "desc-long-2": "ğŸ› Faites face Ã  une centaine de vagues <b>d'ennemis agressifs</b> et de <b>tenaces boss</b>.",
        "desc-long-3": "ğŸ RÃ©coltez diverses <b>armes</b>, rassasiez vous Ã  l'aide <b>d'amÃ©liorations</b>, puis prÃ©parez-vous au combat pour l'Ã©tage suivant !",
        "desc-long-4": "ğŸ <b>Atteignez le haut</b> du gratte-ciel et <b>rÃ©glez vos comptes</b> avec votre patron !",
        "screenshot-title": "Captures",
    
        "contact": "Contact :",
        "footer-source": "Code source de ce site web",
        "banner-author": "Illustration banniÃ¨re par :",
        
        "press-title": "Presse",
        "press-article-list-title": "Ce que les gens disent sur le jeu",
        "press-article-list-add-yours": "Vous souhaitez ajouter votre article?",
        "press-article-list-add-yours-email": "Envoyez-moi un email!",
    },

    // "zh-hans": {
    //     "language-name": "ç®€ä½“ä¸­æ–‡",

    //     "button-steam-wishlist": "ğŸ› åœ¨ Steam æ”¶è—æ„¿æœ›å•",
    //     "button-steam": "ğŸ› Steam",
    //     "button-itchio": "ğŸª itch.io",
    //     "button-discord": "ğŸ® Discord",
    //     "button-twitter": "ğŸ¦ Twitter",
    //     "button-bluesky": "ğŸ¦‹ Bluesky",
    //     "button-instagram": "ğŸ“· Instagram",
    //     "button-github": "ğŸ˜º GitHub",
    //     "button-press": "ğŸ—ï¸ ç›¸å…³æ–‡ç« ",
    //     "button-press-kit": "ğŸ“° ä¸‹è½½åª’ä½“èµ„æ–™åŒ…",
    //     "button-email": "âœ‰ï¸ ç”µå­é‚®ä»¶",

    //     "desc-1": "æ¬¢è¿æ¥åˆ° Bugscraperã€‚",
    //     "desc-2": "<b>Bugscraper</b> æ˜¯ä¸€æ¬¾æ”¯æŒ <b>å•äºº</b> æˆ– <b>æœ¬åœ°åˆä½œ</b> çš„ <b>Roguelike å°„å‡»æ¸¸æˆ</b>ã€‚ä¸€è·¯å‘ä¸Šï¼Œå†²å‘ä½ é‚£æ¶åæ˜­å½°çš„è€æ¿åŠå…¬å®¤ï¼Œå¯¹æŠ—ä¸€å±‚åˆä¸€å±‚çš„æ•Œäººã€‚åˆ©ç”¨å„ç§æ­¦å™¨ä¸å‡çº§ï¼ŒæŠŠæ•Œäººç»Ÿç»Ÿæ¸…æ‰«å¹²å‡€ï¼Œå‘é¡¶å±‚è¿›å‘ï¼",

    //     "desc-long-1": "ğŸœ æ‰®æ¼” <b>Mio å’Œä»–çš„ä¼™ä¼´ä»¬</b>ï¼Œæ”¯æŒ <b>å•äºº</b> æˆ– <b>æœ€å¤š 4 äººçš„æœ¬åœ°åˆä½œ</b>ã€‚",
    //     "desc-long-2": "ğŸ› æŒ‘æˆ˜ <b>ä¸Šç™¾æ³¢</b> <b>ç‹‚æš´æ•Œäºº</b> ä¸ <b>å¼ºå¤§ Boss</b>ã€‚",
    //     "desc-long-3": "ğŸ æ”¶é›† <b>æ–°æ­¦å™¨</b>ï¼Œè·å– <b>å¼ºåŠ›å‡çº§</b>ï¼Œä¸ºä¸‹ä¸€å±‚çš„æˆ˜æ–—åšå¥½å‡†å¤‡ï¼",
    //     "desc-long-4": "ğŸ <b>é—¯ä¸Šå¤§æ¥¼é¡¶å±‚</b>ï¼Œå’Œä½ çš„è€æ¿ä¸€å†³èƒœè´Ÿï¼",

    //     "screenshot-title": "æˆªå›¾",

    //     "contact": "è”ç³»æ–¹å¼ï¼š",
    //     "footer-source": "æœ¬ç½‘ç«™çš„æºä»£ç ",
    //     "banner-author": "æ¨ªå¹…æ’ç”»ï¼š",

    //     "html-title-press": "Bugscraper Â· åª’ä½“",
    //     "press-title": "åª’ä½“",
    //     "press-article-list-title": "åª’ä½“å¯¹æœ¬æ¸¸æˆçš„è¯„ä»·",
    //     "press-article-list-add-yours": "æƒ³æ·»åŠ ä½ çš„æ–‡ç« ï¼Ÿ",
    //     "press-article-list-add-yours-email": "ç»™æˆ‘å‘é‚®ä»¶ï¼"
    // }
}

const defaultLocale = "en";
let locale;

document.addEventListener("DOMContentLoaded", () => {
    let localeToSet = getDefaultLocale();
    
    // alert(localeToSet);
    setLocale(localeToSet);
    bindLocaleSwitcher(localeToSet);
});

function getDefaultLocale() {
    if (typeof(Storage) !== "undefined") {
        const savedLocale = localStorage.getItem("locale")
        if (savedLocale !== null && (savedLocale in translations)) {
            return savedLocale
        }
    }

    const userLanguage = (navigator.language || navigator.userLanguage).slice(0,2);
    if (userLanguage in translations) {
        return userLanguage;
    } 
    return defaultLocale;      
}

function setLocale(newLocale) {
    if (newLocale == locale)  {
        return;
    }
    if ((newLocale in translations) === false) {
        return;
    }
    locale = newLocale;
    translatePage();
    saveLocale();
}

function translatePage() {
    document
        .querySelectorAll("[data-i18n-key]")
        .forEach(translateElement);
}

function saveLocale() {
    // Check browser support
    if (typeof(Storage) !== "undefined") {
        // Store
        localStorage.setItem("locale", locale);
    } else {
        alert("Sorry, your browser does not support Web Storage...");
    }
}

function translateElement(element) {
    const key = element.getAttribute("data-i18n-key");
    const translation = translations[locale][key] ?? translations[defaultLocale][key];
    element.innerHTML = translation;
}

// Whenever the user selects a new locale, we
// load the locale's translations and update
// the page
function bindLocaleSwitcher(initialValue) {
    const switcher = document.querySelector("[data-i18n-switcher]");
    switcher.value = initialValue;
    switcher.onchange = (e) => {
        // Set the locale to the selected option[value]
        setLocale(e.target.value);
    };
}